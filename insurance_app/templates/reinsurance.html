<!DOCTYPE html>
<html>
<head>
    <title>Reinsurance Form</title>
</head>
<body>
    <h3>Reinsurance Form</h3>

    <!-- Add Reinsurance Form -->
    <form id="add-reinsurance-form">
        <input type="number" name="policy_id" placeholder="Policy ID" required>
        <input type="text" name="reinsurer" placeholder="Reinsurer" required>
        <input type="number" name="coverage_amount" placeholder="Coverage Amount" required>
        <input type="date" name="start_date" placeholder="Start Date">
        <input type="date" name="end_date" placeholder="End Date">
        <button type="submit">Add Reinsurance</button>
    </form>

    <h4>Reinsurance List</h4>
    <ul id="reinsurance-list"></ul>

    <!-- ========================= -->
    <!-- Add your POST, PUT, DELETE fetch code -->
    <!-- ========================= -->
    <script>
    function loadReinsurances() {
        fetch('/api/reinsurance/')
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('reinsurance-list');
                list.innerHTML = '';
                data.forEach(reinsurance => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${reinsurance.reinsurer}</strong> - $${reinsurance.coverage_amount} (Policy: ${reinsurance.policy_id})
                        <button onclick="editReinsurance(${reinsurance.id}, '${reinsurance.policy_id}', '${reinsurance.reinsurer}', '${reinsurance.coverage_amount}', '${reinsurance.start_date || ''}', '${reinsurance.end_date || ''}')">Edit</button>
                        <button onclick="deleteReinsurance(${reinsurance.id})">Delete</button>
                    `;
                    list.appendChild(li);
                });
            });
    }

    // POST: Add a new reinsurance
    document.getElementById('add-reinsurance-form').onsubmit = function(e) {
        e.preventDefault();
        const form = e.target;
        fetch('/api/reinsurance/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                policy_id: form.policy_id.value,
                reinsurer: form.reinsurer.value,
                coverage_amount: form.coverage_amount.value,
                start_date: form.start_date.value,
                end_date: form.end_date.value
            })
        })
        .then(response => response.json())
        .then(data => {
            alert('Reinsurance added: ' + data.reinsurer);
            form.reset();
            loadReinsurances();
        });
    };

    // PUT: Edit an existing reinsurance
    function editReinsurance(id, currentPolicyId, currentReinsurer, currentCoverageAmount, currentStartDate, currentEndDate) {
        const policy_id = prompt("Edit policy ID:", currentPolicyId);
        if (policy_id === null) return;
        const reinsurer = prompt("Edit reinsurer:", currentReinsurer);
        if (reinsurer === null) return;
        const coverage_amount = prompt("Edit coverage amount:", currentCoverageAmount);
        if (coverage_amount === null) return;
        const start_date = prompt("Edit start date (YYYY-MM-DD):", currentStartDate);
        const end_date = prompt("Edit end date (YYYY-MM-DD):", currentEndDate);
        fetch(`/api/reinsurance/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({policy_id, reinsurer, coverage_amount, start_date, end_date})
        })
        .then(response => response.json())
        .then(data => {
            alert('Reinsurance updated: ' + data.reinsurer);
            loadReinsurances();
        });
    }

    // DELETE: Remove a reinsurance
    function deleteReinsurance(id) {
        if (!confirm("Are you sure you want to delete this reinsurance?")) return;
        fetch(`/api/reinsurance/${id}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            alert(data.detail);
            loadReinsurances();
        });
    }

    // Initial load
    loadReinsurances();
    </script>
    <!-- ========================= -->
    <!-- End of POST, PUT, DELETE fetch code -->
    <!-- ========================= -->

</body>
</html>
