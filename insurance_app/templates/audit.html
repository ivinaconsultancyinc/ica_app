<!DOCTYPE html>
<html>
<head>
    <title>Audit Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5ss
</head>
<body>
    <h3>Audit Form</h3>

    <!-- Add Audit Form -->
    <form id="add-audit-form">
        <input type="text" name="action" placeholder="Action" required>
        <input type="text" name="user" placeholder="User">
        <input type="datetime-local" name="timestamp" placeholder="Timestamp">
        <input type="text" name="details" placeholder="Details">
        <button type="submit">Add Audit</button>
    </form>

    <h4>Audit List</h4>
    <ul id="audit-list"></ul>

    <!-- ========================= -->
    <!-- Add your POST, PUT, DELETE fetch code -->
    <!-- ========================= -->
    <script>
    function loadAudits() {
        fetch('/api/audit/')
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('audit-list');
                list.innerHTML = '';
                data.forEach(audit => {
                    li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${audit.action}</strong> by ${audit.user || 'N/A'} at ${audit.timestamp || 'N/A'}
                        <button onclick="editAudit(${audit.id}, '${audit.action}', '${audit.user || ''}', '${audit.timestamp || ''}', '${audit.details || ''}')">Edit</button>
                        <button onclick="deleteAudit(${audit.id})">Delete</button>
                    `;
                    list.appendChild(li);
                });
            });
    }

    // POST: Add a new audit
    document.getElementById('add-audit-form').onsubmit = function(e) {
        e.preventDefault();
        const form = e.target;
        fetch('/api/audit/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                action: form.action.value,
                user: form.user.value,
                timestamp: form.timestamp.value,
                details: form.details.value
            })
        })
        .then(response => response.json())
        .then(data => {
            alert('Audit added: ' + data.action);
            form.reset();
            loadAudits();
        });
    };

    // PUT: Edit an existing audit
    function editAudit(id, currentAction, currentUser, currentTimestamp, currentDetails) {
        const action = prompt("Edit action:", currentAction);
        if (action === null) return;
        const user = prompt("Edit user:", currentUser);
        if (user === null) return;
        const timestamp = prompt("Edit timestamp (YYYY-MM-DDTHH:MM):", currentTimestamp);
        const details = prompt("Edit details:", currentDetails);
        fetch(`/api/audit/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({action, user, timestamp, details})
        })
        .then(response => response.json())
        .then(data => {
            alert('Audit updated: ' + data.action);
            loadAudits();
        });
    }

    // DELETE: Remove an audit
    function deleteAudit(id) {
        if (!confirm("Are you sure you want to delete this audit?")) return;
        fetch(`/api/audit/${id}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            alert(data.detail);
            loadAudits();
        });
    }

    // Initial load
    loadAudits();
    </script>
    <!-- ========================= -->
    <!-- End of POST, PUT, DELETE fetch code -->
    <!-- ========================= -->

</body>
</html>
