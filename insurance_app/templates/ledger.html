<!DOCTYPE html>
<html>
<head>
    <title>Ledger Form</title>
    https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css
</head>
<body>
    <h3>Ledger Form</h3>

    <!-- Add Ledger Entry Form -->
    <form id="add-ledger-form">
        <input type="date" name="entry_date" placeholder="Entry Date" required>
        <input type="text" name="description" placeholder="Description">
        <input type="number" name="amount" placeholder="Amount" required>
        <input type="text" name="entry_type" placeholder="Entry Type (debit/credit)">
        <button type="submit">Add Ledger Entry</button>
    </form>

    <h4>Ledger Entries</h4>
    <ul id="ledger-list"></ul>

    <!-- ========================= -->
    <!-- Add your POST, PUT, DELETE fetch code -->
    <!-- ========================= -->
    <script>
    function loadLedgers() {
        fetch('/api/ledger/')
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('ledger-list');
                list.innerHTML = '';
                data.forEach(ledger => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${ledger.entry_date}</strong> - ${ledger.description || ''} $${ledger.amount || 'N/A'} (${ledger.entry_type || 'N/A'})
                        <button onclick="editLedger(${ledger.id}, '${ledger.entry_date}', '${ledger.description || ''}', '${ledger.amount || ''}', '${ledger.entry_type || ''}')">Edit</button>
                        <button onclick="deleteLedger(${ledger.id})">Delete</button>
                    `;
                    list.appendChild(li);
                });
            });
    }

    // POST: Add a new ledger entry
    document.getElementById('add-ledger-form').onsubmit = function(e) {
        e.preventDefault();
        const form = e.target;
        fetch('/api/ledger/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                entry_date: form.entry_date.value,
                description: form.description.value,
                amount: form.amount.value,
                entry_type: form.entry_type.value
            })
        })
        .then(response => response.json())
        .then(data => {
            alert('Ledger entry added.');
            form.reset();
            loadLedgers();
        });
    };

    // PUT: Edit an existing ledger entry
    function editLedger(id, currentEntryDate, currentDescription, currentAmount, currentEntryType) {
        const entry_date = prompt("Edit entry date (YYYY-MM-DD):", currentEntryDate);
        if (entry_date === null) return;
        const description = prompt("Edit description:", currentDescription);
        const amount = prompt("Edit amount:", currentAmount);
        const entry_type = prompt("Edit entry type (debit/credit):", currentEntryType);
        fetch(`/api/ledger/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({entry_date, description, amount, entry_type})
        })
        .then(response => response.json())
        .then(data => {
            alert('Ledger entry updated.');
            loadLedgers();
        });
    }

    // DELETE: Remove a ledger entry
    function deleteLedger(id) {
        if (!confirm("Are you sure you want to delete this ledger entry?")) return;
        fetch(`/api/ledger/${id}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            alert(data.detail);
            loadLedgers();
        });
    }

    // Initial load
    loadLedgers();
    </script>
    <!-- ========================= -->
    <!-- End of POST, PUT, DELETE fetch code -->
    <!-- ========================= -->

</body>
</html>
