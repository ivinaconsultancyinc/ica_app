<!DOCTYPE html>
<html>
<head>
    <title>Policies Form</title>
</head>
<body>
    <h3>Policies Form</h3>

    <!-- Add Policy Form -->
    <form id="add-policy-form">
        <input type="text" name="policy_number" placeholder="Policy Number" required>
        <input type="number" name="client_id" placeholder="Client ID" required>
        <input type="number" name="product_id" placeholder="Product ID" required>
        <input type="date" name="start_date" placeholder="Start Date">
        <input type="date" name="end_date" placeholder="End Date">
        <input type="text" name="status" placeholder="Status">
        <button type="submit">Add Policy</button>
    </form>

    <h4>Policy List</h4>
    <ul id="policy-list"></ul>

    <!-- ========================= -->
    <!-- Add your POST, PUT, DELETE fetch code -->
    <!-- ========================= -->
    <script>
    function loadPolicies() {
        fetch('/api/policies/')
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('policy-list');
                list.innerHTML = '';
                data.forEach(policy => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${policy.policy_number}</strong> (Client: ${policy.client_id}, Product: ${policy.product_id}) ${policy.status || ''}
                        <button onclick="editPolicy(${policy.id}, '${policy.policy_number}', '${policy.client_id}', '${policy.product_id}', '${policy.start_date || ''}', '${policy.end_date || ''}', '${policy.status || ''}')">Edit</button>
                        <button onclick="deletePolicy(${policy.id})">Delete</button>
                    `;
                    list.appendChild(li);
                });
            });
    }

    // POST: Add a new policy
    document.getElementById('add-policy-form').onsubmit = function(e) {
        e.preventDefault();
        const form = e.target;
        fetch('/api/policies/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                policy_number: form.policy_number.value,
                client_id: form.client_id.value,
                product_id: form.product_id.value,
                start_date: form.start_date.value,
                end_date: form.end_date.value,
                status: form.status.value
            })
        })
        .then(response => response.json())
        .then(data => {
            alert('Policy added: ' + data.policy_number);
            form.reset();
            loadPolicies();
        });
    };

    // PUT: Edit an existing policy
    function editPolicy(id, currentPolicyNumber, currentClientId, currentProductId, currentStartDate, currentEndDate, currentStatus) {
        const policy_number = prompt("Edit policy number:", currentPolicyNumber);
        if (policy_number === null) return;
        const client_id = prompt("Edit client ID:", currentClientId);
        if (client_id === null) return;
        const product_id = prompt("Edit product ID:", currentProductId);
        if (product_id === null) return;
        const start_date = prompt("Edit start date (YYYY-MM-DD):", currentStartDate);
        const end_date = prompt("Edit end date (YYYY-MM-DD):", currentEndDate);
        const status = prompt("Edit status:", currentStatus);
        fetch(`/api/policies/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({policy_number, client_id, product_id, start_date, end_date, status})
        })
        .then(response => response.json())
        .then(data => {
            alert('Policy updated: ' + data.policy_number);
            loadPolicies();
        });
    }

    // DELETE: Remove a policy
    function deletePolicy(id) {
        if (!confirm("Are you sure you want to delete this policy?")) return;
        fetch(`/api/policies/${id}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            alert(data.detail);
            loadPolicies();
        });
    }

    // Initial load
    loadPolicies();
    </script>
    <!-- ========================= -->
    <!-- End of POST, PUT, DELETE fetch code -->
    <!-- ========================= -->

</body>
</html>
