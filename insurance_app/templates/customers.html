<!DOCTYPE html>
<html>
<head>
    <title>Customers Form</title>
    https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css
</head>
<body>
    <h3>Customers Form</h3>

    <!-- Add Customer Form -->
    <form id="add-customer-form">
        <input type="text" name="name" placeholder="Name" required>
        <input type="email" name="email" placeholder="Email">
        <input type="text" name="phone" placeholder="Phone">
        <button type="submit">Add Customer</button>
    </form>

    <h4>Customer List</h4>
    <ul id="customer-list"></ul>

    <!-- ========================= -->
    <!-- Add your POST, PUT, DELETE fetch code -->
    <!-- ========================= -->
    <script>
    function loadCustomers() {
        fetch('/api/customers/')
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('customer-list');
                list.innerHTML = '';
                data.forEach(customer => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${customer.name}</strong> - ${customer.email || ''} ${customer.phone ? '(' + customer.phone + ')' : ''}
                        <button onclick="editCustomer(${customer.id}, '${customer.name}', '${customer.email || ''}', '${customer.phone || ''}')">Edit</button>
                        <button onclick="deleteCustomer(${customer.id})">Delete</button>
                    `;
                    list.appendChild(li);
                });
            });
    }

    // POST: Add a new customer
    document.getElementById('add-customer-form').onsubmit = function(e) {
        e.preventDefault();
        const form = e.target;
        fetch('/api/customers/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                name: form.name.value,
                email: form.email.value,
                phone: form.phone.value
            })
        })
        .then(response => response.json())
        .then(data => {
            alert('Customer added: ' + data.name);
            form.reset();
            loadCustomers();
        });
    };

    // PUT: Edit an existing customer
    function editCustomer(id, currentName, currentEmail, currentPhone) {
        const name = prompt("Edit name:", currentName);
        if (name === null) return;
        const email = prompt("Edit email:", currentEmail);
        if (email === null) return;
        const phone = prompt("Edit phone:", currentPhone);
        fetch(`/api/customers/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, email, phone})
        })
        .then(response => response.json())
        .then(data => {
            alert('Customer updated: ' + data.name);
            loadCustomers();
        });
    }

    // DELETE: Remove a customer
    function deleteCustomer(id) {
        if (!confirm("Are you sure you want to delete this customer?")) return;
        fetch(`/api/customers/${id}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            alert(data.detail);
            loadCustomers();
        });
    }

    // Initial load
    loadCustomers();
    </script>
    <!-- ========================= -->
    <!-- End of POST, PUT, DELETE fetch code -->
    <!-- ========================= -->

</body>
</html>
